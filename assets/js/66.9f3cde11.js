(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{483:function(s,n,a){"use strict";a.r(n);var e=a(22),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb"}},[s._v("#")]),s._v(" "),a("strong",[s._v("MongoDB")])]),s._v(" "),a("h3",{attrs:{id:"一、安装数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、安装数据库"}},[s._v("#")]),s._v(" "),a("strong",[s._v("一、安装数据库")])]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.mongodb.com/manual/administration/install-community/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.mongodb.com/manual/administration/install-community/"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"二、启动数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、启动数据库"}},[s._v("#")]),s._v(" "),a("strong",[s._v("二、启动数据库")])]),s._v(" "),a("h5",{attrs:{id:"_1、windows"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、windows"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1、windows")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mongod --dbpath d:/data/db\nmongo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"_2、mac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、mac"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2、mac")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mongod --config /usr/local/etc/mongod.conf\nmongo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"三、数据库操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、数据库操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("三、数据库操作")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("use gp145\ndb/db.getName()\nshow dbs\ndb.createCollection('movies')\ndb.stats()\ndb.version()\ndb.getMongo() //connection to 127.0.0.1:27017\ndb.dropDatabase()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"四、集合操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、集合操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("四、集合操作")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.createCollection('users')\ndb.getCollectionNames()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"五、文档的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、文档的操作"}},[s._v("#")]),s._v(" "),a("strong",[s._v("五、文档的操作")])]),s._v(" "),a("h4",{attrs:{id:"_5-1-添加"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-添加"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5.1 添加")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.users.insertOne({username: 'yangli', password: 'abc123'})\ndb.users.insertOne({username: 'haozeliang', email: 'hzl@126.com'})\ndb.users.insertOne({\"username\": 1, password: 123})\ndb.users.insertMany([{username: 'gaojie', password: 'gj', email: 'gj@126.com'}, {username: 'xinyi', password: 123, email: 123}])\ndb.users.insert([{username: 'yangli'}, {useranme: 'zeliang'}])\ndb.users.save()\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h4",{attrs:{id:"_5-2-修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-修改"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5.2 修改")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.users.update({username: 'yangli'}, {username: 'yl'})\n\n// 1、如果第二个参数是一个对象，后边两个参数无效\n// 2、如果第二个参数是通过$set设置的话， 后两个参数才有效\n// 3、后两个参数的第一个参数：true/如果数据查询不到，就创建 false/如果数据查询不到，就什么都不做\n// 4、后两个参数第第二个参数：true/更新多条，false/更新一条\ndb.users.update({username: 'gp145'}, {$set: {username: 'yl'}}, true, true)\n// 5、如果使用updateMany, 就不需要传递后两个参数第二个了\ndb.users.updateMany({username: 'yl'}, {$set: {username: 'yangli'}})\n db.collection.update(\n   <query>,\n   <update>,\n   {\n     upsert: <boolean>,\n     multi: <boolean>,\n     writeConcern: <document>,\n     collation: <document>,\n     arrayFilters: [ <filterdocument1>, ... ],\n     hint:  <document|string>  // Available starting in MongoDB 4.2\n   }\n)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("参考文档：")]),a("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/method/db.collection.update/#db.collection.update",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.mongodb.com/manual/reference/method/db.collection.update/#db.collection.update"),a("OutboundLink")],1)])]),s._v(" "),a("h4",{attrs:{id:"_5-3-删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-删除"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5.3 删除")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.users.remove({username: 'xinyi'}, true)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[a("strong",[s._v("参考文档：")]),a("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/method/db.collection.remove/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://docs.mongodb.com/manual/reference/method/db.collection.remove/"),a("OutboundLink")],1)])]),s._v(" "),a("h4",{attrs:{id:"_5-4-查找"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-查找"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5.4 查找")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("db.movies.find({}, {nm: 1, _id: 0, rt: 1})\ndb.movies.find({}, {nm: 1, _id: 0, rt: 1}).sort({rt: -1})\ndb.movies.find({}, {nm: 1, _id: 0, rt: 1}).limit(10)\ndb.movies.find({}, {nm: 1, _id: 0, rt: 1}).sort({rt: -1}).limit(10)\ndb.movies.find({}, {nm: 1, _id: 0, rt: 1}).sort({rt: -1}).limit(3).skip(6)\ndb.movies.find({rt: {$gte: '2019-10-14'}}, {nm: 1, _id: 0, rt: 1})\ndb.movies.find({rt: {$gte: '2019-10-14'}}, {nm: 1, _id: 0, rt: 1})\ndb.movies.find({rt: {$gte: '2019-10-14'}}, {nm: 1, _id: 0, rt: 1}).count()\ndb.movies.find({rt: {$lte: '2019-10-14'}}, {nm: 1, _id: 0, rt: 1}).count()\ndb.movies.find({nm: /小/}, {nm: 1, _id: 0, rt: 1}).sort({rt: -1})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"六、数据库管理工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、数据库管理工具"}},[s._v("#")]),s._v(" "),a("strong",[s._v("六、数据库管理工具")])]),s._v(" "),a("p",[a("strong",[s._v("robo 3T")])]),s._v(" "),a("h1",{attrs:{id:"ii、mongoose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ii、mongoose"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Ⅱ、Mongoose")])]),s._v(" "),a("h3",{attrs:{id:"_1、数据库连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、数据库连接"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1、数据库连接")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const mongoose = require('mongoose')\nmongoose.connect('mongodb://localhost:27017/lagou-admin', { useUnifiedTopology: true, useNewUrlParser: true })\n\nconst Users = mongoose.model('users', {\n  username: String,\n  password: String\n})\n\nmodule.exports = {\n  Users\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_2、route"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、route"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2、Route")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("var express = require('express')\nvar router = express.Router()\n\nconst { signup, hasUsername } = require('../controllers/users')\n\nrouter.post('/signup', hasUsername, signup)\n\nmodule.exports = router\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_3、model"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、model"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3、Model")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const { Users } = require('../utils/db')\n\nconst save = (data) => {\n  const users = new Users(data)\n  return users.save()\n}\n\nconst findOne = (conditions) => {\n  return Users.findOne(conditions)\n}\n\nmodule.exports = {\n  save,\n  findOne\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_4、view"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、view"}},[s._v("#")]),s._v(" "),a("strong",[s._v("4、View")])]),s._v(" "),a("p",[a("strong",[s._v("art-template + express")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{\n  "ret": true,\n  "data": {{data}}\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_5、controller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、controller"}},[s._v("#")]),s._v(" "),a("strong",[s._v("5、Controller")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("const usersModel = require('../models/users')\n\nconst signup = async function(req, res, next) {\n  res.set('Content-Type', 'application/json; charset=utf-8')\n\n  let { username, password } = req.body\n\n  let result = await usersModel.save({\n    username,\n    password: hash\n  })\n\n  if (result) {\n    res.render('succ', {\n      data: JSON.stringify({\n        message: '用户注册成功.'\n      })\n    })\n  } else {\n    res.render('fail', {\n      data: JSON.stringify({\n        message: '用户注册失败.'\n      })\n    })\n  }\n}\n\nconst hasUsername = async function(req, res, next) {\n  res.set('Content-Type', 'application/json; charset=utf-8')\n  let { username } = req.body\n  let result = await usersModel.findOne({username})\n  if (result) {\n    res.render('fail', {\n      data: JSON.stringify({\n        message: '用户名已经存在.'\n      })\n    })\n  } else {\n    next()\n  }\n}\n\nmodule.exports = {\n  signup,\n  hasUsername\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);